---
title: ğŸ‡å£°æ˜å¼ç»„ä»¶
date: 2022-07-02 22:02:46
permalink: /pages/f33919/
---

ä½•è°“å£°æ˜å¼ç»„ä»¶ï¼Ÿ

ä¹‹å‰ç« èŠ‚ä»‹ç»çš„æ™®é€šç»„ä»¶å’Œæ¡ä»¶ç»„ä»¶ï¼Œåœ¨å†™æ³•ä¸Šéœ€è¦ä½ è‡ªå·±å»å®šä¹‰ä¸€ä¸ªç±»å»ç»§æ‰¿`NodeComponent`æˆ–è€…`NodeSwitchComponent`ã€‚è¿™æ ·ä¸€æ–¹é¢é€ æˆäº†è€¦åˆï¼Œå¦ä¸€æ–¹é¢ç”±äºjavaæ˜¯å•ç»§æ‰¿åˆ¶ï¼Œæ‰€ä»¥ä½¿ç”¨è€…å°±æ— æ³•å†å»ç»§æ‰¿è‡ªå·±çš„ç±»äº†ï¼Œåœ¨è‡ªç”±åº¦ä¸Šå°±å°‘äº†å¾ˆå¤šç©æ³•ã€‚

å£°æ˜å¼ç»„ä»¶è¿™ä¸€ç‰¹æ€§å…è®¸ä½ è‡ªå®šä¹‰çš„ç»„ä»¶ä¸ç»§æ‰¿ä»»ä½•ç±»å’Œå®ç°ä»»ä½•æ¥å£ï¼Œæ™®é€šçš„ç±»ä¹Ÿå¯ä»¥ä¾é æ³¨è§£æ¥å®ŒæˆLiteFlowç»„ä»¶çš„å£°æ˜ã€‚



## æ™®é€šç»„ä»¶çš„å£°æ˜

ä½ å¯ä»¥å¦‚ä¸‹å»è¿›è¡Œä¸€ä¸ªæ™®é€šç»„ä»¶çš„å£°æ˜ï¼š

```java
@LiteflowComponent("a")
@LiteflowCmpDefine
public class ACmp{
  
	@LiteflowMethod(LiteFlowMethodEnum.PROCESS)
	public void processAcmp(NodeComponent bindCmp) {
		System.out.println("ACmp executed!");
	}

	@LiteflowMethod(LiteFlowMethodEnum.IS_ACCESS)
	public boolean isAcmpAccess(NodeComponent bindCmp){
		return true;
	}

	@LiteflowMethod(LiteFlowMethodEnum.BEFORE_PROCESS)
	public void beforeAcmp(String nodeId, Slot<DefaultContext> slot){
		System.out.println("before A");
	}

	@LiteflowMethod(LiteFlowMethodEnum.AFTER_PROCESS)
	public void afterAcmp(String nodeId, Slot<DefaultContext> slot){
		System.out.println("after A");
	}

	@LiteflowMethod(LiteFlowMethodEnum.ON_SUCCESS)
	public void onAcmpSuccess(NodeComponent bindCmp){
		System.out.println("Acmp success");
	}

	@LiteflowMethod(LiteFlowMethodEnum.ON_ERROR)
	public void onAcmpError(NodeComponent bindCmp){
		System.out.println("Acmp error");
	}
	
	@LiteflowMethod(LiteFlowMethodEnum.IS_END)
	public boolean isAcmpEnd(NodeComponent bindCmp) {
		return false;
	}
}
```



ä½¿ç”¨è€…æ— éœ€ç»§æ‰¿`NodeSwitchComponent`äº†ï¼Œåœ¨ä½ å®šä¹‰çš„ç±»ä¸Šï¼Œåªè¦ç±»ä¸ŠåŠ ä¸Š`LiteflowCmpDefine`æ³¨è§£ï¼Œç›¸åº”çš„æ–¹æ³•ä¸ŠåŠ ä¸Š`LiteflowMethod`æ³¨è§£ï¼Œå³å¯å®Œæˆå¯¹ä»»æ„è‡ªå®šä¹‰ç±»çš„ç»„ä»¶åŒ–å·¥ä½œã€‚

å…¶ä¸­`LiteFlowMethod`çš„ä½œç”¨æ˜¯æŠŠä½ è‡ªå·±çš„å®šä¹‰çš„æ–¹æ³•æ˜ å°„æˆç»„ä»¶çš„æ–¹æ³•ã€‚é™¤äº†æœ‰ç¤ºä¾‹ä¸Šçš„å€¼å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„æ˜ å°„æ–¹æ³•ã€‚å…·ä½“å¯ä»¥çœ‹ä¸‹[æ™®é€šç»„ä»¶](/pages/8486fb/)ç« èŠ‚ã€‚



::: tip

è¿™é‡Œæ³¨æ„çš„æ˜¯ï¼Œå¤§éƒ¨åˆ†æ–¹æ³•ä¸Šå‚æ•°å¿…é¡»ä¼ å…¥`NodeComponent bindCmp`è¿™ä¸ªå‚æ•°ï¼Œè€Œä¸”å¿…é¡»åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œè€Œ`beforeProcess`å’Œ`afterProcess`è¿˜æ˜¯æŒ‰ç…§ä»¥å‰çš„å‚æ•°å®šä¹‰ã€‚è¿™ç‚¹è¦æ³¨æ„ä¸‹ï¼Œå¯ä»¥æŸ¥çœ‹ä¸Šé¢çš„ç¤ºä¾‹ã€‚

ä»¥å‰è·å–ä¸Šä¸‹æ–‡Beanæ˜¯ç”¨`this`å…³é”®å­—ï¼Œç°åœ¨åªéœ€ä»bindCmpä¸­è·å–å°±å¯ä»¥äº†ã€‚

æ–¹æ³•çš„åç§°å¯ä»¥å®šä¹‰æˆä½ æƒ³è¦çš„ä»»ä½•æ–¹å¼ã€‚è¿™ä¸ªå¹¶æ— é™åˆ¶ã€‚

:::

## é€‰æ‹©ç»„ä»¶çš„å£°æ˜

å£°æ˜é€‰æ‹©ç»„ä»¶å’Œæ™®é€šç»„ä»¶å·®ä¸å¤šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
@Component("e")
@LiteflowSwitchCmpDefine
public class ECmp{

    @LiteflowMethod(LiteFlowMethodEnum.PROCESS_SWITCH)
    public String processSwitch(NodeComponent bindCmp) throws Exception {
        System.out.println("Ecomp executed!");
        return "g";
    }
}
```



## å…³äºå®ç°

å£°æ˜å¼ç»„ä»¶ä¾é åŠ¨æ€ä»£ç†æ¥å®ç°ï¼Œåº•å±‚ç”¨çš„åŠ¨æ€ä»£ç†æ¡†æ¶ä¸ºByteBuddyã€‚

æ‰€æœ‰çš„åŠ¨æ€ä»£ç†ç±»åœ¨æ³¨å†Œæ—¶ç±»åå‡åšäº†å¤„ç†ï¼Œæ‰€ä»¥ä½ ä¼šçœ‹åˆ°å¦‚ä¸‹çš„æ—¥å¿—æ‰“å°

```
2022-05-16 13:05:56.492  INFO 73054 --- [           main] c.y.l.test.base.cmp.ByteBuddy$a$JLWBAK   : [51fbe478db8c4b2cb7ad7519aee0b92d]:[O]start component[ByteBuddy$a$JLWBAK] execution
2022-05-16 13:05:56.496  INFO 73054 --- [           main] c.y.l.test.base.cmp.ByteBuddy$b$JZXUWG   : [51fbe478db8c4b2cb7ad7519aee0b92d]:[O]start component[ByteBuddy$b$JZXUWG] execution
2022-05-16 13:05:56.505  INFO 73054 --- [lf-when-thead-0] c.y.l.test.base.cmp.ByteBuddy$c$RWWUCJ   : [51fbe478db8c4b2cb7ad7519aee0b92d]:[O]start component[ByteBuddy$c$RWWUCJ] execution
2022-05-16 13:05:56.506  INFO 73054 --- [lf-when-thead-1] c.y.l.test.base.cmp.ByteBuddy$d$RECNPY   : [51fbe478db8c4b2cb7ad7519aee0b92d]:[O]start component[ByteBuddy$d$RECNPY] execution
```



ä»”ç»†çœ‹ä¼šå‘ç°ï¼Œæ‰€æœ‰çš„åŠ¨æ€ä»£ç†åçš„ç±»åçš„æ ¼å¼ä¸ºï¼š**ByteBuddy$ä½ çš„ç»„ä»¶å$éšæœº6ä½å­—ç¬¦ä¸²**ã€‚

æ‰€ä»¥åœ¨çœ‹æ—¥å¿—æ—¶ï¼Œå¯¹äºå£°æ˜å¼ç»„ä»¶è€Œè¨€ï¼Œä½ åªéœ€è¦çœ‹ä¸¤ä¸ª$ä¸­é—´çš„é‚£ä¸ªï¼Œå³ä¸ºä½ çš„ç»„ä»¶IDã€‚è¿™ç‚¹æ€•æœ‰äººæœ‰ç–‘æƒ‘ï¼Œç‰¹åœ°è¯´æ˜ä¸€ä¸‹ã€‚
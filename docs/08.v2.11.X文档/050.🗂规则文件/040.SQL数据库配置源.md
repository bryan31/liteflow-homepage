---
title: ğŸ“˜SQLæ•°æ®åº“é…ç½®æº
date: 2022-10-06 23:18:42
permalink: /pages/236b4f/
---

LiteFlowä»v2.9.0å¼€å§‹ï¼ŒåŸç”Ÿæ”¯æŒäº†æ ‡å‡†å…³ç³»å‹ç»“æ„åŒ–æ•°æ®åº“çš„é…ç½®æºï¼Œåªè¦ä½ çš„æ•°æ®åº“å…¼å®¹æ ‡å‡†SQLè¯­æ³•ï¼Œéƒ½å¯ä»¥æ”¯æŒã€‚

## ä¾èµ–

å¦‚æœä½¿ç”¨æ•°æ®åº“ä½œä¸ºè§„åˆ™é…ç½®æºï¼Œä½ éœ€è¦æ·»åŠ ä»¥ä¸‹é¢å¤–æ’ä»¶ä¾èµ–ï¼š

```xml
<dependency>
    <groupId>com.yomahub</groupId>
    <artifactId>liteflow-rule-sql</artifactId>
    <version>2.11.1</version>
</dependency>
```

## é…ç½®

ä¾èµ–äº†æ’ä»¶åŒ…ä¹‹åï¼Œä½ æ— éœ€å†é…ç½®`liteflow.ruleSource`è·¯å¾„ã€‚

åªéœ€è¦é…ç½®æ’ä»¶çš„é¢å¤–å‚æ•°å³å¯ï¼š

<code-group>
  <code-block title="Yamlé£æ ¼é…ç½®" active>
```yaml
liteflow:
  rule-source-ext-data-map:
    url: jdbc:mysql://localhost:3306/poseidon
    driverClassName: com.mysql.cj.jdbc.Driver
    username: root
    password: 123456
    applicationName: demo
    #æ˜¯å¦å¼€å¯SQLæ—¥å¿—
    sqlLogEnabled: true
    #æ˜¯å¦å¼€å¯SQLæ•°æ®è½®è¯¢è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ é»˜è®¤ä¸å¼€å¯
    pollingEnabled: true
    pollingIntervalSeconds: 60
    pollingStartSeconds: 60
    #ä»¥ä¸‹æ˜¯chainè¡¨çš„é…ç½®ï¼Œè¿™ä¸ªä¸€å®šå¾—æœ‰
    chainTableName: chain
    chainApplicationNameField: application_name
    chainNameField: chain_name
    elDataField: el_data
    #ä»¥ä¸‹æ˜¯scriptè¡¨çš„é…ç½®ï¼Œå¦‚æœä½ æ²¡ä½¿ç”¨åˆ°è„šæœ¬ï¼Œä¸‹é¢å¯ä»¥ä¸é…ç½®
    scriptTableName: script
    scriptApplicationNameField: application_name
    scriptIdField: script_id
    scriptNameField: script_name
    scriptDataField: script_data
    scriptTypeField: script_type
    scriptLanguageField: script_language
```
  </code-block>
  <code-block title="Propertiesé£æ ¼é…ç½®">

```properties
liteflow.rule-source-ext-data={\
  "url":"jdbc:mysql://localhost:3306/poseidon",\
  "driverClassName":"com.mysql.cj.jdbc.Driver",\
  "username":"root",\
  "password":"123456",\
  "applicationName": "demo",\
  "sqlLogEnabled": true,\
  "pollingEnabled": true,\
  "pollingIntervalSeconds": 60,\
  "pollingStartSeconds": 60,\
  "chainTableName": "chain",\
  "chainApplicationNameField": "application_name",\
  "chainNameField": "chain_name",\
  "elDataField": "el_data",\
  "scriptTableName": "script",\
  "scriptApplicationNameField": "application_name",\
  "scriptIdField": "script_id",\
  "scriptNameField": "script_name",\
  "scriptDataField": "script_data",\
  "scriptTypeField": "script_type",\
  "scriptLanguageField": "script_language"
  }
```
  </code-block>
</code-group>

## é…ç½®è¯´æ˜

LiteFlowå¹¶ä¸çº¦æŸä½ çš„è¡¨åå’Œè¡¨ç»“æ„ï¼Œä½ åªéœ€è¦æŠŠè¡¨åå’Œç›¸å…³çš„å­—æ®µåé…ç½®åœ¨å‚æ•°é‡Œå³å¯ã€‚

å¯¹äºé…ç½®é¡¹è¯´æ˜å¦‚ä¸‹ï¼š

| é…ç½®é¡¹                        | è¯´æ˜                                                            |
|----------------------------|---------------------------------------------------------------|
| url                        | jdbcçš„è¿æ¥url                                                    |
| driverClassName            | é©±åŠ¨å™¨ç±»å                                                         |
| username                   | æ•°æ®åº“ç”¨æˆ·å                                                        |
| password                   | æ•°æ®åº“å¯†ç                                                          |
| applicationName            | ä½ çš„åº”ç”¨åç§°                                                        |
| sqlLogEnabled              | æ˜¯å¦å¼€å¯SQLæ—¥å¿— é»˜è®¤å¼€å¯                                                |
| pollingEnabled             | æ˜¯å¦å¼€å¯SQLæ•°æ®è½®è¯¢è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ é»˜è®¤ä¸å¼€å¯                                       |
| pollingIntervalSeconds     | SQLæ•°æ®è½®è¯¢æ—¶é—´é—´éš”(s) é»˜è®¤ä¸º60s                                         |
| pollingStartSeconds        | è§„åˆ™é…ç½®åé¦–æ¬¡è½®è¯¢çš„èµ·å§‹æ—¶é—´(s) é»˜è®¤ä¸º60s                                      |
| chainTableName             | ç¼–æ’è§„åˆ™è¡¨çš„è¡¨å                                                      |
| chainApplicationNameField  | ç¼–æ’è§„åˆ™è¡¨ä¸­åº”ç”¨åç§°å­˜å‚¨å­—æ®µå                                               |
| chainNameField             | è§„åˆ™åç§°å­˜å‚¨çš„å­—æ®µå                                                    |
| elDataField                | ELè¡¨è¾¾å¼çš„å­—æ®µ(åªå­˜EL)                                                |
| scriptTableName            | ä½ çš„è„šæœ¬å­˜å‚¨è¡¨çš„è¡¨å                                                    |
| scriptApplicationNameField | è„šæœ¬è¡¨ä¸­åº”ç”¨åç§°å­˜å‚¨å­—æ®µå                                                 |
| scriptIdField              | è„šæœ¬ç»„ä»¶çš„Idçš„å­—æ®µå                                                   |
| scriptNameField            | è„šæœ¬ç»„ä»¶åç§°çš„å­—æ®µå                                                    |
| scriptDataField            | è„šæœ¬æ•°æ®çš„å­—æ®µå                                                      |
| scriptTypeField            | è„šæœ¬ç±»å‹çš„å­—æ®µå(ç±»å‹å‚ç…§[å®šä¹‰è„šæœ¬ç»„ä»¶](/pages/81d53c/))                        |
| scriptLanguageField        | è„šæœ¬è¯­è¨€ç±»å‹ï¼ˆgroovy \| qlexpress \| js \| python \| lua \| aviatorï¼‰ |

<br>

åœ¨æ•°æ®åº“ä¸­ï¼Œä½ è‡³å°‘éœ€è¦ä¸€å¼ è¡¨æ¥å­˜å‚¨ç¼–æ’è§„åˆ™ï¼Œè¿™æ˜¯å¿…é¡»çš„ã€‚

å¦‚æœä½ ä½¿ç”¨åˆ°äº†è„šæœ¬ï¼Œé‚£ä¹ˆéœ€è¦ç¬¬äºŒå¼ è¡¨æ¥å­˜å‚¨è„šæœ¬ã€‚

åœ¨è§„åˆ™è¡¨ä¸­ï¼Œä¸€è¡Œæ•°æ®å°±æ˜¯ä¸€ä¸ªè§„åˆ™ã€‚åœ¨è„šæœ¬è¡¨ä¸­ï¼Œä¸€è¡Œæ•°æ®å°±æ˜¯ä¸€ä¸ªè„šæœ¬ç»„ä»¶ã€‚

<br>

ä¸¾ä¾‹ï¼š

è§„åˆ™è¡¨ï¼šliteflow_chain

| id   | application_name | chain_name | chain_desc | el_data               | create_time         |
| ---- | ---------------- | ---------- | ---------- | --------------------- | ------------------- |
| 1    | demo             | chain1     | æµ‹è¯•æµç¨‹1  | THEN(a, b, c, s1,s2); | 2022-09-19 19:31:00 |

è„šæœ¬è¡¨ï¼šliteflow_script

| id   | application_name | script_id | script_name | script_data                                                  | script_type | script_language | create_time         |
| ---- | ---------------- | --------- | ----------- | ------------------------------------------------------------ | ----------- | --------------- | ------------------- |
| 1    | demo             | s1        | è„šæœ¬s1      | import cn.hutool.core.date.DateUtil<br>def date = DateUtil.parse("2022-10-17 13:31:43")<br>println(date) defaultContext.setData("demoDate", date)<br>class Student {<br/>   int studentID<br/>   String studentName<br/>}<br/>Student student = new Student() student.studentID = 100301 student.studentName = "å¼ ä¸‰" defaultContext.setData("student",student)  def a=3<br/>def b=2<br/>defaultContext.setData("s1",a*b) | script      | groovy          | 2022-09-19 19:31:00 |
| 2    | demo             | s2        | è„šæœ¬s2      | defaultContext.setData("s2","hello")                         | script      | groovy          | 2022-09-19 19:31:00 |


## ä½¿ç”¨ä½ é¡¹ç›®ä¸­çš„dataSourceæ¥è¿›è¡Œè¿æ¥

LiteFlowä»v2.10.6å¼€å§‹æ”¯æŒäº†ä½¿ç”¨é¡¹ç›®ä¸­å·²å­˜åœ¨çš„Datasourceæ¥è¿›è¡Œæ•°æ®åº“è¿æ¥ã€‚å¦‚æœä½ é¡¹ç›®ä¸­å·²æœ‰é“¾æ¥é…ç½®ï¼Œæ¯”å¦‚ï¼š

```properties
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/poseidon
spring.datasource.username=root
spring.datasource.password=123456
```

é‚£ä¹ˆä½ åœ¨`rule-source-ext-data-map`ä¸­æ— éœ€å†é…ç½®ä»¥ä¸‹å‡ é¡¹ï¼š

```yaml
url: jdbc:mysql://localhost:3306/poseidon
driverClassName: com.mysql.cj.jdbc.Driver
username: root
password: 123456
```

::: tip
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ çš„ç³»ç»Ÿä¸­å£°æ˜äº†å¤šä¸ªæ•°æ®æºï¼Œé‚£ä¹ˆLiteFlowä¼šè‡ªåŠ¨åˆ¤æ–­è¯¥é€‰ç”¨å“ªä¸ªæ•°æ®æºã€‚

å¦‚æœä½ çš„ç³»ç»Ÿä¸­ä½¿ç”¨äº†åŠ¨æ€æ•°æ®æºï¼Œé‚£ä¹ˆè¯·ç¡®ä¿é»˜è®¤æ•°æ®æºæ˜¯å«æœ‰LiteFlowé“¾è·¯æ•°æ®çš„è¡¨æ•°æ®çš„ã€‚
:::

## è½®è¯¢è‡ªåŠ¨åˆ·æ–°

LiteFlowä»v2.11.1å¼€å§‹ï¼Œæ”¯æŒSQLæ•°æ®æºè½®è¯¢æ¨¡å¼çš„è‡ªåŠ¨åˆ·æ–°æœºåˆ¶ã€‚ä½ å¯ä»¥åœ¨é…ç½®é¡¹ä¸­é€šè¿‡`pollingEnabled: true`æ¥å¼€å¯è‡ªåŠ¨åˆ·æ–°ï¼š

<code-group>
  <code-block title="Yamlé£æ ¼é…ç½®" active>
```yaml
liteflow:
  rule-source-ext-data-map:
    ...
    pollingEnabled: true
    ##ä»¥ä¸‹éå¿…é¡»ï¼Œé»˜è®¤1åˆ†é’Ÿ
    pollingIntervalSeconds: 60
    pollingStartSeconds: 60
    ...
```
  </code-block>
  <code-block title="Propertiesé£æ ¼é…ç½®">

```properties
liteflow.rule-source-ext-data={\
  ...\
  "pollingEnabled": true,\
  "pollingIntervalSeconds": 60,\
  "pollingStartSeconds": 60,\
  ...
  }
```
  </code-block>
</code-group>

è½®è¯¢æ¨¡å¼çš„è‡ªåŠ¨åˆ·æ–°æ ¹æ®é¢„è®¾çš„æ—¶é—´é—´éš”å®šæ—¶æ‹‰å–SQLä¸­çš„æ•°æ®ï¼Œä¸æœ¬åœ°ä¿å­˜çš„æ•°æ®SHAå€¼è¿›è¡Œå¯¹æ¯”æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°æ•°æ®ã€‚

å®šæ—¶è½®è¯¢å­˜åœ¨äº›å¾®çš„æ€§èƒ½æ¶ˆè€—ï¼›å—è½®è¯¢é—´éš”é™åˆ¶ï¼Œæ•°æ®æ›´æ–°æœ‰ä¸€å®šå»¶è¿Ÿæ€§ã€‚


## å°ä¾‹å­
ä¸ºäº†è®©å¤§å®¶èƒ½ç®€å•ä¸Šæ‰‹SQLè§„åˆ™æ–‡ä»¶çš„é…ç½®å’Œè¿è¡Œï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå°demoï¼Œå¤§å®¶å¯ä»¥æ‹‰åˆ°æœ¬åœ°æ¥è¿è¡Œï¼Œéœ€è¦ä½ æ›¿æ¢æ•°æ®åº“çš„é…ç½®ä¿¡æ¯ã€‚

è¿è¡Œé¡¹ç›®å‰ï¼Œå…ˆè¯»é¡¹ç›®é‡Œçš„`readme.txt`æ–‡ä»¶ã€‚

> https://github.com/bryan31/liteflow-ext-rule-demo
---
title: ğŸ¥—å¼‚æ­¥çº¿ç¨‹æ± è‡ªå®šä¹‰
date: 2022-07-03 11:21:39
permalink: /pages/7280ea/
---

## é»˜è®¤å…¨å±€çº¿ç¨‹æ± 

LiteFlowè‡ªå·±é»˜è®¤æœ‰å…¨å±€çº¿ç¨‹æ± ï¼Œå¹¶ä¸”çº¿ç¨‹æ± çš„å¤§å°ç­‰å‚æ•°å¯ä»¥é€šè¿‡è®¾ç½®ä»¥ä¸‹å‚æ•°æ¥è¿›è¡Œè®¾ç½®ï¼š

```properties
liteflow.when-max-wait-seconds=15
liteflow.when-max-workers=16
liteflow.when-queue-limit=512
```

## è‡ªå®šä¹‰å…¨å±€çº¿ç¨‹æ± 

ä½†æ˜¯å¦‚æœä½ è¦å¯¹çº¿ç¨‹æ± æœ‰ç‰¹æ®ŠåŒ–çš„è¦æ±‚ï¼ŒLiteFlowä¹Ÿæ”¯æŒè‡ªå®šä¹‰çº¿ç¨‹æ± çš„è®¾ç½®ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‡ªå®šä¹‰çº¿ç¨‹æ± åªé€‚ç”¨äºå¹¶è¡Œç»„ä»¶ï¼Œè¿™ä¸ªå‚æ•°å¯¹äºåŒæ­¥ç»„ä»¶æ¥è¯´å¹¶æ— ä½œç”¨ã€‚è€Œä¸”ä¸€æ—¦è®¾ç½®äº†ä½ è‡ªå®šä¹‰çš„çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆä»¥ä¸Šå‚æ•°å°†ä¸ä¼šå†æœ‰ç”¨ã€‚å¯¹äºçº¿ç¨‹æ± çš„æ‰€æœ‰å‚æ•°çš„å®šä¹‰ï¼Œéƒ½å–å†³äºä½ è‡ªå·±äº†ã€‚



é¦–å…ˆä½ å¯ä»¥è¿™æ ·å®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ± çš„Builderï¼š

```java
public class CustomThreadBuilder implements ExecutorBuilder {
    @Override
    public ExecutorService buildExecutor() {
        return Executors.newCachedThreadPool();
    }
}
```



ç„¶åæŠŠä½ çš„BuilderåŠ å…¥LiteFlowçš„é…ç½®ä¸­ï¼Œspringbootçš„è¯ï¼Œä½ å¯ä»¥è¿™æ ·é…ç½®ï¼š

```properties
liteflow.thread-executor-class=com.yomahub.liteflow.test.customThreadPool.CustomThreadBuilder
```



å¦‚æœæ˜¯springçš„è¯ï¼Œä½ å¯ä»¥è¿™æ ·é…ç½®ï¼š

```xml
<bean id="liteflowConfig" class="com.yomahub.liteflow.property.LiteflowConfig">
	<property name="ruleSource" value="customThreadPool/flow.xml"/>
    <property name="threadExecutorClass" value="com.yomahub.liteflow.test.customThreadPool.CustomThreadBuilder"/>
</bean>

<bean id="flowExecutor" class="com.yomahub.liteflow.core.FlowExecutor">
  <property name="liteflowConfig" ref="liteflowConfig"/>
</bean>
```



è¿™æ ·ï¼ŒLiteFlowåœ¨å¯åŠ¨çš„æ—¶å€™å°±ä¼šè‡ªåŠ¨é€šè¿‡ä½ å£°æ˜çš„BuilderåŠ è½½åˆ°è‡ªå®šä¹‰çš„çº¿ç¨‹æ± äº†ã€‚



## `WHEN`çº§åˆ«çš„å•ç‹¬çº¿ç¨‹æ± 

åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä½ çš„å¼‚æ­¥èŠ‚ç‚¹å¯èƒ½ä¸éœ€è¦ä¸€ä¸ªå…¨å±€çš„çº¿ç¨‹æ± ï¼Œå¸Œæœ›å¯¹æ¯ç»„å¼‚æ­¥èŠ‚ç‚¹è¿›è¡Œå•ç‹¬çš„çº¿ç¨‹æ± è®¾å®šã€‚

æ¯”å¦‚æˆ‘ç°åœ¨æƒ³å¯¹ä»¥ä¸‹2ä¸ªæµç¨‹å¼‚æ­¥èŠ‚ç‚¹è¿›è¡Œè®¾ç½®ä¸åŒçš„çº¿ç¨‹æ± :

```xml
<chain name="chain1">
    WHEN(a, b);
</chain>

<chain name="chain2">
    WHEN(c, d);
</chain>
```

é‚£ä¹ˆç°åœ¨ä½ å¯ä»¥è¿™ä¹ˆåš

é¦–å…ˆå®ç°2ä¸ªè‡ªå·±çš„çº¿ç¨‹æ± ï¼š

```java
public class CustomThreadExecutor1 implements ExecutorBuilder {

    @Override
    public ExecutorService buildExecutor() {
        //æ„é€ ä½ è‡ªå®šä¹‰çš„çº¿ç¨‹æ± 
    }
}
```

```java
public class CustomThreadExecutor2 implements ExecutorBuilder {

    @Override
    public ExecutorService buildExecutor() {
        //æ„é€ ä½ è‡ªå®šä¹‰çš„çº¿ç¨‹æ± 
    }
}
```

ç„¶åä½ å¦‚ä¸‹å£°æ˜å°±okäº†ï¼š

```xml
<chain name="chain1">
    WHEN(a, b).threadPool("com.yomahub.liteflow.test.customWhenThreadPool.CustomThreadExecutor1");
</chain>
<chain name="chain2">
    WHEN(c, d).threadPool("com.yomahub.liteflow.test.customWhenThreadPool.CustomThreadExecutor2");
</chain>
```



## ä¼˜å…ˆçº§

å¦‚æœå…¨å±€å’Œ`Condition`éƒ½é…ç½®è‡ªå®šä¹‰çº¿ç¨‹æ± çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆä½¿ç”¨`Condition`ä¸Šé…ç½®çš„çº¿ç¨‹æ± ã€‚

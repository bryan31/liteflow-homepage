---
title: 🍉设置组件参数语法
date: 2022-10-06 22:55:30
permalink: /pages/6e4d15/
---

组件参数是指给组件编排中设置特定的参数。这些参数能在组件中能被轻易取出来参与逻辑运算。

LiteFlow能给组件设置参数的关键有三个，分别为`tag`,`data`和`bind`，它们做的事都是设置参数，但是在各自的场景上又略微有不同。以下篇幅会分别介绍。

## tag语法的用法

`tag`有2种用途：

* 用于`SWITCH`语法的选择
* 赋值

关于`SWITCH`的选择`tag`标签内容请参考[选择编排](/pages/d90483/)这一章。

这章主要阐述`tag`标签的赋值功能。

你可以在规则表达式里给每个组件添加运行时的标签值，用`tag`关键字表示：

```xml
<chain name="chain1">
    THEN(
        a.tag("tag1"),
        b.tag("tag2"),
        c.tag("tag3")
    );
</chain>
```

这样，你在代码里可以通过`this.getTag()`获取到当前的标签，这在有些时候非常有用，尤其是当多个相同组件编排时，你可以根据`tag`来获知到不同的参数。或者根据tag标签来给相同的组件作不同的判断。

```java
@LiteflowComponent("b")
public class BCmp extends NodeComponent {
    @Override
    public void process() {
        String tag = this.getTag();
        ...
    }
}
```

当然，以下这种例子也是可以的:

```xml
<chain name="chain1">
    THEN(
        a.tag("1"), a.tag("2"), a.tag("3"), a.tag("4"), a.tag("5"), a.tag("6")
    );
</chain>
```

## data语法的用法<Badge text="v2.9.0+"/>

你可以在EL语法中通过`data`来给组件设置外置参数，建议最好是JSON格式：

```xml
<flow>
    <chain name="chain1">
        cmpData = '{"name":"jack","age":27,"birth":"1995-10-01"}';
    
        THEN(a, b.data(cmpData), c);
    </chain>
    
    <chain name="chain2">
        cmpData = '{"name":"rose","age":20,"birth":"1997-07-01"}';
    
        WHEN(c, b.data(cmpData));
    </chain>
</flow>
```

上述表达式中，同一个b组件，在不同的chain中被赋予了不同的外置参数，运行中在组件中通过`this.getCmpData`方法也能拿到相应的参数。

如果上述对象是一个Json的数组，在组件中也可以通过`getCmpDataList`方法来获取。

这个方法是可以返回对应结构的java对象的，只要传入相对应的class即可。

```java
@LiteflowComponent("b")
public class BCmp extends NodeComponent {

	@Override
	public void process() {
		User user = this.getCmpData(User.class);
		...
	}

}
```

要注意的是，`data`关键字也可以用作于表达式，子变量，chain上，其意义是被赋值的表达式/子变量/chain里所有的组件都设置了相同的值，比如：

```xml
<chain name="chain1">
    THEN(a, b, c).data("123");
</chain>
```

```xml
<chain name="chain1">
    sub = WHEN(b, c);
    THEN(a, sub.data(""))
</chain>
```

```xml
<chain name="chain1">
    THEN(a, b, c);
</chain>

<chain name="chain2">
    WHEN(x, y, chain1.data("123"));
</chain>
```

## bind语法的用法<Badge text="v2.13.0+"/>

LiteFlow还提供了`bind`语法关键字，它和`data`使用场景是一致的，但是它和`data`关键不同的是，它允许绑定KV键值对，比如

```xml
<chain id="chain1">
    THEN(a.bind("k1", "test"), b);
</chain>
```

你可以在组件中通过`getBindData`方法来获取：

```java
@LiteflowComponent("a")
public class ACmp extends NodeComponent {
	@Override
	public void process() {
		String bindValue = this.getBindData("k1", String.class);
		...
	}
}
```

当然bind的时候也可以把value设置成json字符串，那么在取值的时候，第二个参数就可以传相应的VO的class，LiteFlow内部可以自动把Json转型成对象。

`bind`关键字也可以用作于表达式，子变量，chain上，其意义是被赋值的表达式/子变量/chain里所有的组件都绑定了相同的值，比如：

```xml
<chain id="chain1">
    THEN(a,b).bind("k1","test");
</chain>

<chain id="chain2">
    THEN(SWITCH(y).TO(d,c), WHEN(a, b), IF(x, c, d)).bind("k1", "test")
</chain>

<chain id="sub">
    THEN(a,IF(NOT(x), b, c));
</chain>

<chain id="chain3">
    THEN(d, sub.bind("k1", "test2"))
</chain>
```




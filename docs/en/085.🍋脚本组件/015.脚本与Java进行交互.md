---
title: ğŸ£è„šæœ¬ä¸Javaè¿›è¡Œäº¤äº’
date: 2022-10-05 14:18:24
permalink: /pages/script/interacts/
---

:::tip
è¿™ç« åªé€‚ç”¨äºgroovy,js,python,qlexpress,lua,aviatorè¿™6ç§è„šæœ¬è¯­è¨€ã€‚

v2.11.0æ–°å¢çš„Javaè„šæœ¬è¯­è¨€å’ŒJavaç±»çš„äº¤äº’æ–¹å¼åœ¨[Javaè„šæœ¬å¼•æ“](/en/pages/script/type/java/)ä¸­å·²åšäº†è¯¦ç»†è¯´æ˜ã€‚
:::

## å’Œä¸Šä¸‹æ–‡è¿›è¡Œäº¤äº’

å› ä¸ºLiteFlowç»„ä»¶ä¸ç»„ä»¶ä¹‹é—´çš„æ•°æ®äº¤äº’éƒ½åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œæ‰€ä»¥åœ¨è„šæœ¬è¯­è¨€ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ä½ å®šä¹‰æ•°æ®ä¸Šä¸‹æ–‡çš„classNameçš„é©¼å³°å½¢å¼æ¥è·å–æ•°æ®ã€‚

æ¯”å¦‚ä½ çš„ä¸Šä¸‹æ–‡ç±»å«`OrderContext`ï¼Œé‚£ä¹ˆè„šæœ¬ä¸­çš„å°±ç”¨`orderContext`è¿™ä¸ªå…³é”®å­—æ¥è·å–æ•°æ®æˆ–è°ƒç”¨æ–¹æ³•ã€‚

å¦‚æœä½ æ˜¯å¤šä¸Šä¸‹æ–‡ï¼ŒåŒæ ·çš„ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨è„šæœ¬ä¸­ç”¨å¤šä¸ªä¸Šä¸‹æ–‡æ¥è·å–æ•°æ®æˆ–è°ƒç”¨contextå†…éƒ¨çš„é€»è¾‘æ–¹æ³•ã€‚

æ¯”å¦‚ï¼Œä½ æƒ³è·å–`UserContext`ä¸­çš„`userName`å¯¹è±¡ã€‚ä½ å¯ä»¥è¿™æ ·å†™ï¼ˆä»¥ä¸‹ä»¥groovyä½œä¾‹å­ï¼‰ï¼š

```xml
<node id="s1" name="æ™®é€šè„šæœ¬" type="script">
    <![CDATA[
        //ä½ å¯ä»¥è¿™æ ·å®šä¹‰
        def name = userContext.userName;
        //ä¹Ÿå¯ä»¥è¿™æ ·å®šä¹‰ï¼Œå¦‚æœä½ å¯¹userNameæœ‰getteræ–¹æ³•çš„è¯
        def name = userContext.getUserName();
        //åŒç†ï¼Œä½ å¯ä»¥è°ƒç”¨æ•°æ®ä¸Šä¸‹æ–‡ä¸­çš„ä»»æ„æ–¹æ³•
        userContext.doYourMethod();
    ]]>
</node>
```

## è‡ªå®šä¹‰ä¸Šä¸‹æ–‡å¼•ç”¨åç§°

ä¸Šæ–‡æåˆ°ï¼Œåœ¨è„šæœ¬ä¸­é»˜è®¤çš„ä¸Šä¸‹æ–‡å¼•ç”¨è§„åˆ™ä¸ºä¸Šä¸‹æ–‡ç±»çš„simpleClassNameï¼Œæ¯”å¦‚ä½ çš„ä¸Šä¸‹æ–‡ä¸º`UserContext`ï¼Œé‚£ä¹ˆè„šæœ¬å°±ç”¨`userContext`å»å¼•ç”¨ã€‚

é‚£ä¹ˆå¯ä¸å¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªä¸Šä¸‹æ–‡çš„åç§°å‘¢ï¼Ÿ

å¯ä»¥ã€‚LiteFlowä»2.10.0ç‰ˆæœ¬å¼€å§‹æ”¯æŒè¿™ä¸ªåŠŸèƒ½ï¼Œå¦‚æœä½ ä¸æƒ³ç”¨`userContext`æ¥å¼•ç”¨ï¼Œé‚£ä¹ˆåªéœ€åŠ ä¸€ä¸ª`@ContextBean`çš„æ³¨è§£å³å¯å®Œæˆï¼š

```java
@ContextBean("userCxt")
public class UserContext {
    ...
}
```

è¿™æ ·å®šä¹‰åï¼Œé‚£ä¹ˆè„šæœ¬ä¸­ï¼Œä½ å°±å¯ä»¥ç”¨`userCtxt`å…³é”®å­—å»å¼•ç”¨ä¸Šä¸‹æ–‡äº†ã€‚

## å…ƒæ•°æ®

åœ¨è„šæœ¬ä¸­å¯ä»¥ç”¨é€šè¿‡`_meta`å…³é”®å­—è·å–å…ƒæ•°æ®ï¼Œå¯ä»¥é€šè¿‡`_meta.xxx`è·å–å…ƒæ•°æ®ï¼Œå…ƒæ•°æ®é‡ŒåŒ…æ‹¬ï¼š

* **slotIndex:** slotä¸‹æ ‡ï¼Œå¯ä»¥é€šè¿‡FlowBus.getSlot(slotIndex)æ¥è·å¾—slotæ•°æ®
* **currChainId:** å½“å‰æ‰§è¡Œchainçš„åç§°
* **nodeId:** å½“å‰æ‰§è¡Œnodeçš„Id
* **tag:** tagå€¼ï¼Œå…³äºtagçš„è¯´æ˜è¯·æŸ¥çœ‹[ç»„ä»¶æ ‡ç­¾](/en/pages/advance/tag/)
* **cmpData:** ç»„ä»¶è§„åˆ™å‚æ•°ï¼Œå…³äºcmpDataçš„è¯´æ˜è¯·æŸ¥çœ‹[ç»„ä»¶å‚æ•°](/en/pages/advance/cmpparam/)
* **loopIndex:** åœ¨å¾ªç¯ä¸­çš„å¾ªç¯ä¸‹æ ‡
* **loopObject:** åœ¨è¿­ä»£å¾ªç¯ä¸­çš„å¾ªç¯å¯¹è±¡
* **requestData:** æµç¨‹åˆå§‹å‚æ•°
* **subRequestData:** å½“å‰éšå¼æµç¨‹çš„å…¥å‚ï¼Œå¦‚æœæ­¤èŠ‚ç‚¹ç¼–æ’åœ¨éšå¼æµç¨‹é‡Œçš„è¯ï¼Œèƒ½è·å–åˆ°ï¼Œåä¹‹ä¸èƒ½

## å’Œè‡ªå®šä¹‰çš„JavaBeanè¿›è¡Œäº¤äº’

LiteFlowä»v2.9.0å¼€å§‹æ”¯æŒåœ¨è„šæœ¬ä¸­æ³¨å…¥ä½ è‡ªå·±å®šä¹‰çš„ä»»ä½•javaå¯¹è±¡ã€‚

åœ¨springä½“ç³»ä¸­ï¼Œä½ åªéœ€è¦åœ¨ä½ éœ€è¦æ³¨å…¥çš„javaå¯¹è±¡ä¸Šä½¿ç”¨`@ScriptBean`æ ‡æ³¨ï¼Œå³å¯å®Œæˆæ³¨å…¥ã€‚

```java
@Component
@ScriptBean("demo")
public class DemoBean1 {

    @Resource
    private DemoBean2 demoBean2;

    public String getDemoStr1(){
        return "hello";
    }

    public String getDemoStr2(String name){
        return demoBean2.getDemoStr2(name);
    }
}
```

ä»¥ä¸Šä¾‹å­ä¸­ï¼Œè„šæœ¬é‡Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨`demo`å…³é”®å­—æ¥è°ƒç”¨`getDemoStr1()`å’Œ`getDemoStr2()`æ–¹æ³•äº†ã€‚

æˆ‘ä»¬åœ¨LiteFlow 2.9.5ç‰ˆæœ¬æ”¯æŒäº†`@ScriptBean`çš„æŒ‡å®šæ–¹æ³•å’Œæ’é™¤æ–¹æ³•åŠŸèƒ½ã€‚

å¦‚æœä½ æƒ³æŒ‡å®šè¿™ä¸ªç±»ä¸­çš„æŸ2ä¸ªæ–¹æ³•å¯ä»¥è¢«è„šæœ¬è®¿é—®åˆ°ï¼Œä½ å¯ä»¥è¿™æ ·å†™ï¼š

```java
@Component
@ScriptBean(name = "demo", includeMethodName = {"test1","test2"})
public class DemoBean3 {

    public String test1(String name){
        ...
    }

    public String test2(String name){
        ...
    }

    public String test3(String name){
        ...
    }
}
```

è¿™æ ·ä½ åœ¨è„šæœ¬ä¸­åªèƒ½è®¿é—®`test1`å’Œ`test2`æ–¹æ³•ã€‚

å¦‚æœä½ æƒ³æŒ‡å®šè¿™ä¸ªç±»ä¸­çš„æŸäº›è®¿é—®æ— æ³•è¢«è„šæœ¬è®¿é—®åˆ°ï¼Œä½ å¯ä»¥è¿™æ ·å†™ï¼š

```java
@Component
@ScriptBean(name = "demo", excludeMethodName = {"test2","test3"})
public class DemoBean4 {

    public String test1(String name){
        ...
    }

    public String test2(String name){
        ...
    }

    public String test3(String name){
        ...
    }
}
```

è¿™æ ·ä½ åœ¨è„šæœ¬ä¸­åªèƒ½è®¿é—®åˆ°`test1`æ–¹æ³•äº†ã€‚

::: tip
éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œjavaå¯¹è±¡åœ¨springä½“ç³»ä¸­ä¸€å®šè¦æ³¨å†Œè¿›ä¸Šä¸‹æ–‡ï¼Œå¦‚æœä¸æ³¨å†Œè¿›ä¸Šä¸‹æ–‡ï¼Œå…‰åŠ `@ScriptBean`æ³¨è§£ä¹Ÿæ˜¯æ²¡ç”¨çš„ã€‚
:::

åœ¨éspringä½“ç³»ä¸‹é¢ï¼Œå¦‚æœä½ è¦æŠŠè‡ªå·±çš„å®šä¹‰çš„javaå¯¹è±¡æ³¨å…¥è„šæœ¬ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨å†™ä»£ç ï¼ˆæœ€å¥½åœ¨å¯åŠ¨åº”ç”¨çš„æ—¶å€™ï¼‰ï¼š

```java
ScriptBeanManager.addScriptBean("demo", new DemoBean());
```

## ç›´æ¥æ³¨å…¥æ–¹æ³•

å¦‚æœä½ æœ‰ä¸€ä¸ªjavaç±»ï¼Œé‡Œé¢æœ‰100ä¸ªæ–¹æ³•ï¼Œè€Œæˆ‘åªæƒ³æš´éœ²å…¶1ä¸ªç»™è„šæœ¬ä½¿ç”¨ï¼Œç”¨`@ScriptBean`å¯èƒ½ä¼šæŠŠæ•´ä¸ªbeanéƒ½æš´éœ²å‡ºå»ï¼Œæœ‰æ²¡æœ‰æ–¹æ³•å‘¢ï¼Ÿ

æœ‰ã€‚LiteFlowä»2.9.5å¼€å§‹åŠ å…¥äº†`@ScriptMethod`æ³¨è§£ï¼Œåœ¨æ–¹æ³•ä¸Šè¿›è¡Œæ ‡æ³¨ï¼š

```java
@Component
public class DemoBean1 {

    @ScriptMethod("demo")
    public String getDemoStr1() {
        return "hello";
    }

    public String method2() {
       ...
    }
       
    public String method3() {
       ...
    }
    
    ...
}
```

è¿™æ ·ï¼Œä½ å°±å¯ä»¥åœ¨è„šæœ¬ä¸­ç”¨`demo.getDemoStr1()`æ¥è°ƒç”¨åˆ°ç›¸åº”çš„javaæ–¹æ³•äº†ã€‚

::: tip
å½“ç„¶è¿™é‡Œçš„å‰æåŒæ ·æ˜¯ï¼šjavaå¯¹è±¡åœ¨springä½“ç³»ä¸­ä¸€å®šè¦æ³¨å†Œè¿›ä¸Šä¸‹æ–‡ï¼Œå¦‚æœä¸æ³¨å†Œè¿›ä¸Šä¸‹æ–‡ï¼Œå…‰åŠ `@ScriptMethod`æ³¨è§£ä¹Ÿæ˜¯æ²¡ç”¨çš„ã€‚
:::


(window.webpackJsonp=window.webpackJsonp||[]).push([[735],{1198:function(t,s,a){"use strict";a.r(s);var n=a(8),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("之前在"),s("RouterLink",{attrs:{to:"/pages/74b4bf/"}},[t._v("上下文说明")]),t._v("这一小章节已经阐述了上下文在LiteFlow框架中是非常重要的概念。")],1),t._v(" "),s("p",[t._v("如果有些新手同学对上下文这一概念还不理解，可以看看这小章的说明。")]),t._v(" "),s("br"),t._v(" "),s("p",[t._v("LiteFlow所有的组件"),s("code",[t._v("process")]),t._v("方法都是无参无返回构造，组件之间的传递参数以及返回的数据都是通过上下文来进行操作的。")]),t._v(" "),s("h2",{attrs:{id:"为什么要这么设计呢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么要这么设计呢"}},[t._v("#")]),t._v(" 为什么要这么设计呢？")]),t._v(" "),s("p",[t._v("我们知道在java中调用方法，都是要通过方法名+参数进行调用的，要调用一个方法就必须提供这个方法所需的参数。A方法里调用B方法，等同于A方法强耦合了B方法。")]),t._v(" "),s("p",[t._v("而LiteFlow的核心特性在于编排，如果每个方法名和参数都不一样，就无法做到可替换，可更换顺序。所以必须把组件都设计成一样的模式，消除每个组件的差异性，才能进行编排。")]),t._v(" "),s("p",[t._v("LiteFlow的做法是设计成无参无返回模式，增加了上下文这一概念，业务组件所需要的参数从上下文取，所产出的结果也放到上下文中。")]),t._v(" "),s("p",[t._v("这样设计有两大好处：")]),t._v(" "),s("ul",[s("li",[t._v("每一个组件只和上下文发生联系，而无需和其他组件发生联系。这样就消除了组件与组件之间的耦合性。")]),t._v(" "),s("li",[t._v("上下文中的数据是共享给当前请求中所有的组件的，我们平时写代码，如果调用关系是： A->B->C，如果A数据要传递给C，那么要一层层的传下去。而在LiteFlow中，如果A把数据放入上下文，则B和C都可以获取到。")])]),t._v(" "),s("br"),t._v(" "),s("p",[t._v("每一个请求会产生一个上下文对象，不同请求之间的上下文是隔离开来的。而每个请求结束后，当前的上下文会被销毁回收。")]),t._v(" "),s("h2",{attrs:{id:"上下文和请求参数有什么区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#上下文和请求参数有什么区别"}},[t._v("#")]),t._v(" 上下文和请求参数有什么区别")]),t._v(" "),s("p",[t._v("在LiteFlow中调用一个流程，经常会这么调用：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("flowExecutor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute2Resp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"chain1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" requestArg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("LiteFlow中请求初始参数和上下文不是一个东西。")])]),t._v(" "),s("p",[t._v("初始请求参数代表这个流程开始调用时，从这个流程外部传入的参数，这个初始参数也是贯穿整个流程的，任何一个组件都可以用"),s("code",[t._v("this.getRequestData()")]),t._v("获取到。")]),t._v(" "),s("p",[t._v("上下文是用来存放组件之间产生的数据的，LiteFlow会去初始化这个上下文的class，形成一个全新的实例，在一开始，这个上下文里面是没有任何数据的，组件把执行完的结果数据放入，然后其他组件需要的时候再进行取出，同时链路的最终结果也应该放在上下文中，在组件中用"),s("code",[t._v("this.getContextBean()")]),t._v("获取。最终流程的response也能通过"),s("code",[t._v("response.getContextBean()")]),t._v("获取到。")]),t._v(" "),s("br"),t._v(" "),s("p",[t._v("在社区里有一些同学这样写：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomContext")]),t._v(" context "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ncontext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LiteflowResponse")]),t._v(" response "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" flowExecutor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute2Resp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"chain1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("br"),t._v(" "),s("p",[t._v("然后他在组件里这样取：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomContext")]),t._v(" context "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getContextBean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("问我为什么name等于null。")]),t._v(" "),s("br"),t._v(" "),s("p",[t._v("前面说到，"),s("strong",[t._v("LiteFlow中请求初始参数和上下文不是一个东西。")])]),t._v(" "),s("p",[t._v("所以，这些同学这么写，是把一个实例context单独作为了requestData，而"),s("code",[t._v("this.getContextBean")]),t._v("却是另外一个实例。")]),t._v(" "),s("p",[t._v("其实requestData可以是任何对象，只不过这里传的初始参数恰好是CustomContext类型的而已，如果你想取到这个初始参数的CustomContext对象，依然用"),s("code",[t._v("this.getRequestData()")]),t._v(" 来获取。")]),t._v(" "),s("br"),t._v(" "),s("p",[t._v("然而有的同学就是想把初始参数包裹在上下文里面，怎么办，难道还专门在第一个组件里，把初始参数set进context里面吗？")]),t._v(" "),s("p",[t._v("LiteFlow其实在"),s("RouterLink",{attrs:{to:"/pages/f05ed6/"}},[t._v("文档中")]),t._v("也有提到，可以传入已经初始化好的Context。")],1),t._v(" "),s("p",[t._v("应该这么写：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomContext")]),t._v(" context "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CustomContext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ncontext"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxxx"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("LiteflowResponse")]),t._v(" response "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" flowExecutor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("execute2Resp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"chain1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("br"),t._v(" "),s("p",[t._v("其实这就是把初始参数和上下文揉到了一起的体现。")]),t._v(" "),s("br"),t._v(" "),s("p",[t._v("LiteFlow的官方建议还是将初始参数和上下文区分开比较好，理由有以下2点：")]),t._v(" "),s("p",[t._v("1.初始参数是不应该被更改的。而上下文里的数据可以随时被更改的。区分开来比较好")]),t._v(" "),s("p",[t._v("2.初始参数可以是任何结构对象，而上下文只是各个组件运行态时所需要的数据对象。如果初始化参数对象被耦合到上下文对象结构里，则从分层理念上来说，是过于耦合了，不利于扩展。")]),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"上下文中的属性如何保证线程安全"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#上下文中的属性如何保证线程安全"}},[t._v("#")]),t._v(" 上下文中的属性如何保证线程安全")]),t._v(" "),s("p",[t._v("由于组件编排存在着并发性(WHEN)，那么上下文的某一个对象可能同时会被多个组件访问，那么这时候如何保证线程安全性以及一致性呢。")]),t._v(" "),s("p",[t._v("由于上下文对象是由使用者定义的，所以这个线程安全性需要由使用者来去处理。在问答中也有解释，"),s("RouterLink",{attrs:{to:"/pages/845dff/#q-上下文里的数据是线程安全的吗"}},[t._v("跳转到相关问答")]),t._v("。")],1),t._v(" "),s("h2",{attrs:{id:"多上下文的使用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多上下文的使用场景"}},[t._v("#")]),t._v(" 多上下文的使用场景")]),t._v(" "),s("p",[t._v("LiteFlow支持在调用时传入多个上下文对象。很多小伙伴不明白这在什么场景使用。")]),t._v(" "),s("p",[t._v("其实这个特性就是为一些通用组件来准备的。")]),t._v(" "),s("p",[t._v("有的时候通用组件会被复用到很多流程中去。而每个流程的上下文又是不一样的。那么你可以为这个通用组件单独定义一个上下文，然后每次调用，你都传入2个上下文，一个为业务上下文，一个为通用组件上下文。使上下文之间的结构分离，完成通用编排。")])])}),[],!1,null,null,null);s.default=e.exports}}]);